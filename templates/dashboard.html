<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alert Management</title>
</head>
<p>欢迎用户 {{.userID}} </p>
<body>
    <h1>Send an enterprise WeChat alert</h1>
    <form action="/alert/send" method="post">
        <label>Token:</label><br>
        <input type="text" name="token" required><br><br>

        <label>Alert Name:</label><br>
        <input type="text" name="alertname"><br><br>

        <label>Severity:</label><br>
        <input type="text" name="severity"><br><br>

        <label>Instance:</label><br>
        <input type="text" name="instance"><br><br>

        <label>Status:</label><br>
        <input type="text" name="status"><br><br>

        <label>Message:</label><br>
        <textarea name="message" rows="4" cols="50"></textarea><br><br>

        <input type="submit" value="Send">
    </form>

    <h2>Sent history</h2>
    <div id="history"></div>

    <script>
        async function loadHistory() {
            let res = await fetch('/alert/history');
            let data = await res.json();
            let html = "<ul>";
            data.forEach(a => {
                html += `<li>${a.AlertName} - ${a.Severity} - ${a.Instance} - ${a.Message} - ${a.Status} - ${a.CreatedAt}</li>`;
            });
            html += "</ul>";
            document.getElementById("history").innerHTML = html;
        }
        loadHistory();
    </script>
</body>
</html>
